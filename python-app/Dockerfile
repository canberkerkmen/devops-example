#FROM python:3.9-alpine@sha256:bb1875c3835ae6f8be9e7b11345908ea8e3edf5ccdd3ea8b11b7420a67a7a62a
FROM python:3.9-alpine@sha256:e9e622efa97094cd13039e91361e9e7d60ad050dc954de602bf56207ba831f77 

LABEL maintainer="Canberk Erkmen"

ARG REQUIREMENTS_FULL_PATH=requirements.txt
ARG VARIABLE_NAME=application
ARG APPLICATION_DIRECTORY=app
ARG MODULE_NAME=app
ARG WORKER_PROCESS=1
ARG THREAD=1
ARG SERVER_PORT=5000

ARG MYSQL_USERNAME=user
ARG MYSQL_PASSWORD=password
ARG MYSQL_INSTANCE_NAME=db
ARG MYSQL_PORT_3306_TCP_ADDR=mysql-container
ARG MYSQL_PORT_3306_TCP_PORT=3306

ENV VARIABLE_NAME=${VARIABLE_NAME}
ENV APPLICATION_DIRECTORY=${APPLICATION_DIRECTORY}
ENV MODULE_NAME=${MODULE_NAME}
ENV WORKER_PROCESS=${WORKER_PROCESS}
ENV THREAD=${THREAD}
ENV SERVER_PORT=${SERVER_PORT}

ENV MYSQL_USERNAME=${MYSQL_USERNAME}
ENV MYSQL_PASSWORD=${MYSQL_PASSWORD}
ENV MYSQL_INSTANCE_NAME=${MYSQL_INSTANCE_NAME}
ENV MYSQL_PORT_3306_TCP_ADDR=${MYSQL_PORT_3306_TCP_ADDR}
ENV MYSQL_PORT_3306_TCP_PORT=${MYSQL_PORT_3306_TCP_PORT}

COPY ${REQUIREMENTS_FULL_PATH} /
RUN pip3 install -r ${REQUIREMENTS_FULL_PATH}

COPY . /app
WORKDIR /app

ENTRYPOINT ["./gunicorn.sh"]
